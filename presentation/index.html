<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
        <section>
          <h3>Original code snippet</h3>
          <pre>
            <code class="java" data-trim>
              Table table = new Table();

              for (User user : users) {
                if (user.isEnabled()) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  table.addRow(row);
                }
              }

              table.render();
            </code>
          </pre>
        </section>

        <section>
          <section>
            <h3>Introducing filter</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="4">
                Table table = new Table();

                for (User user : users) {
                  if (user.isEnabled()) {
                    Row row = new Row();
                    row.addColumn(new Column(user.fullName());
                    String role = user.isAdmin() ? "Admin" : "Member";
                    row.addColumn(new Column(role));
                    table.addRow(row);
                  }
                }

                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>Predicate</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="3-8">
                Table table = new Table();

                List&lt;User&gt; enabledUsers = new ArrayList&lt;User&gt;();
                for (User user : users) {
                  if (user.isEnabled()) {
                    enabledUsers.add(user);
                  }
                }

                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  table.addRow(row);
                }

                table.render();
              </code>
            </pre>
          </section>
        </section>

        <section>
          <section>
            <h3>Mutation</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="1,15">
                Table table = new Table();

                List&lt;User&gt; enabledUsers = new ArrayList&lt;User&gt;();
                for (User user : users) {
                  if (user.isEnabled()) {
                    enabledUsers.add(user);
                  }
                }

                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  table.addRow(row);
                }

                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>Intro Map</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="8,14,18">
                List&lt;User&gt; enabledUsers = new ArrayList&lt;User&gt;();
                for (User user : users) {
                  if (user.isEnabled()) {
                    enabledUsers.add(user);
                  }
                }

                List&lt;Row&gt; rows = new ArrayList&lt;Row&gt;();
                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  rows.add(row);
                }

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>
        </section>

        <section>
          <section>
            <h3>First refactor - 1/3</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="1-6">
                List&lt;User&gt; enabledUsers = new ArrayList&lt;User&gt;();
                for (User user : users) {
                  if (user.isEnabled()) {
                    enabledUsers.add(user);
                  }
                }

                List&lt;Row&gt; rows = new ArrayList&lt;Row&gt;();
                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  rows.add(row);
                }

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>First refactor - 2/3</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="8-15">
                List&lt;User&gt; enabledUsers = new ArrayList&lt;User&gt;();
                for (User user : users) {
                  if (user.isEnabled()) {
                    enabledUsers.add(user);
                  }
                }

                List&lt;Row&gt; rows = new ArrayList&lt;Row&gt;();
                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  rows.add(row);
                }

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>First refactor - 3/3</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="17-19">
                List&lt;User&gt; enabledUsers = new ArrayList&lt;User&gt;();
                for (User user : users) {
                  if (user.isEnabled()) {
                    enabledUsers.add(user);
                  }
                }

                List&lt;Row&gt; rows = new ArrayList&lt;Row&gt;();
                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  rows.add(row);
                }

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>
        </section>

        <section>
          <section>
            <h1>Refactoring JDK 8+</h1>
          </section>

          <section>
            <h3>JDK 8+ Filter - Before</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="1-6">
                List&lt;User&gt; enabledUsers = new ArrayList&lt;User&gt;();
                for (User user : users) {
                  if (user.isEnabled()) {
                    enabledUsers.add(user);
                  }
                }

                List&lt;Row&gt; rows = new ArrayList&lt;Row&gt;();
                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  rows.add(row);
                }

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>JDK 8+ Filter - After</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="1-3">
                List&lt;User&gt; enabledUsers = users.stream()
                  .filter(user -> user.isEnabled())
                  .collect(Collectors.toList());

                List&lt;Row&gt; rows = new ArrayList&lt;Row&gt;();
                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  rows.add(row);
                }

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>JDK 8+ Map - Before</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="5-12">
                List&lt;User&gt; enabledUsers = users.stream()
                  .filter(user -> user.isEnabled())
                  .collect(Collectors.toList());

                List&lt;Row&gt; rows = new ArrayList&lt;Row&gt;();
                for (User user : enabledUsers) {
                  Row row = new Row();
                  row.addColumn(new Column(user.fullName());
                  String role = user.isAdmin() ? "Admin" : "Member";
                  row.addColumn(new Column(role));
                  rows.add(row);
                }

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>JDK 8+ Map - After</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="5-13">
                List&lt;User&gt; enabledUsers = users.stream()
                  .filter(user -> user.isEnabled())
                  .collect(Collectors.toList());

                List&lt;Row&gt; rows = enabledUsers.stream()
                  .map(user -> {
                    Row row = new Row();
                    row.addColumn(new Column(user.fullName());
                    String role = user.isAdmin() ? "Admin" : "Member";
                    row.addColumn(new Column(role));
                    rows.add(row);
                  })
                  .collect(Collectors.toList());

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>

          <section>
            <h3>JDK 8+ Filter + Map</h3>
            <pre>
              <code class="java" data-trim data-line-numbers="2-3,10">
                List&lt;User&gt; enabledUsers = users.stream()
                  .filter(user -> user.isEnabled())
                  .map(user -> {
                    Row row = new Row();
                    row.addColumn(new Column(user.fullName());
                    String role = user.isAdmin() ? "Admin" : "Member";
                    row.addColumn(new Column(role));
                    rows.add(row);
                  })
                  .collect(Collectors.toList());

                Table table = new Table();
                table.addRows(rows);
                table.render();
              </code>
            </pre>
          </section>
        </section>

        <section>
          <section>
            <h1>Refactoring Legacy Code</h1>
          </section>

          <section>
            <h3>JDK 5, 6, 7 - Missing pieces</h3>
            <ul>
              <li>lambdas</li>
              <li>first-class functions</li>
              <li>high order functions</li>
            </ul>
          </section>

          <section>
            <h3>JDK 5, 6, 7 - What we have</h3>
            <ul>
              <li>Anonymous classes</li>
              <li>Generics</li>
            </ul>
          </section>

          <section>
            <h3>Swing - Anonymous Classes</h3>
            <pre>
              <code class="java" data-trim>
                JButton submitButton = new JButton("Submit");
                submitButton.addActionListener(new ActionListener() {
                  @Override
                  public void actionPerformed(ActionEvent e) {
                    // Do something
                  }
                });
              </code>
            </pre>
          </section>

          <section>
            <h3>Legacy Filter - Before</h3>
            <pre>
              <code class="java" data-trim>
                interface Filter&lt;A&gt; {
                  boolean filter(A element);
                }

                &lt;A&gt; List&lt;A&gt; filter(Filter&lt;A&gt; predicate, List&lt;A&gt; list) {
                  List&lt;A&gt; result = new ArrayList&lt;A&gt;();
                  for (A element : list) {
                    if (predicate.filter(element)) {
                      result.add(element);
                    }
                  }
                  return result;
                }
              </code>
            </pre>
          </section>

          <section>
            <h3>Legacy Filter - After</h3>
            <pre>
              <code class="java" data-trim>
                List&lt;User&gt; enabledUsers = filter(new Filter&lt;User&gt;() {
                  @Override
                  public boolean filter(User user) {
                    return user.isEnabled();
                  }
                }, users);
              </code>
            </pre>
          </section>

          <section>
            <h3>Legacy Map - Before</h3>
            <pre>
              <code class="java" data-trim>
                interface Mapper&lt;A, B&gt; {
                  B map(A element);
                }

                &lt;A, B&gt; List&lt;B&gt; map(Mapper&lt;A, B&gt; mapper, List&lt;A&gt; list) {
                  List&lt;B&gt; result = new ArrayList&lt;B&gt;();
                  for (A element : list) {
                    result.add(mapper.map(element));
                  }
                  return result;
                }
              </code>
            </pre>
          </section>

          <section>
            <h3>Legacy Map - After</h3>
            <pre>
              <code class="java" data-trim>
                List&lt;Row&gt; rows = map(new Mapper&lt;User, Row&gt;() {
                  @Override
                  public Row map(User user) {
                    Row row = new Row();
                    row.addColumn(new Column(user.fullName());
                    String role = user.isAdmin() ? "Admin" : "Member";
                    row.addColumn(new Column(role));
                    return row;
                  })
                }, enabledUsers);
              </code>
            </pre>
          </section>

          <section>
            <h3>Legacy Filter + Map</h3>
            <pre>
              <code class="java" data-trim>
                List&lt;Row&gt; rows = map(new Mapper&lt;User, Row&gt;() {
                  @Override
                  public Row map(User user) {
                    Row row = new Row();
                    row.addColumn(new Column(user.fullName());
                    String role = user.isAdmin() ? "Admin" : "Member";
                    row.addColumn(new Column(role));
                    return row;
                  })
                }, filter(new Filter&lt;User&gt;() {
                  @Override
                  public boolean filter(User user) {
                    return user.isEnabled();
                  })
                }, users));
              </code>
            </pre>
          </section>
        </section>

        <section>
          <section>
            <h1>Common abstractions</h1>
          </section>

          <section>
            <pre>
              <code class="java" data-trim>
                interface Filter&lt;A&gt; {
                  boolean filer(A element);
                }

                interface Mapper&lt;A, B&gt; {
                  B map(A element);
                }
              </code>
            </pre>
          </section>

          <section>
            <h3>The Function abstraction</h3>
            <pre>
              <code class="java" data-trim>
                interface F&lt;A, B&gt; {
                  B apply(A element);
                }
              </code>
            </pre>
          </section>

          <section>
            <h3>The Function abstraction - Refactor Predicate</h3>
            <pre>
              <code class="java" data-trim>
                interface Predicate&lt;A&gt; extends F&lt;A, Boolean&gt;
              </code>
            </pre>
          </section>
        </section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
